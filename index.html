<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Olive OS – Live Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      padding: 20px;
      color: #333;
    }
    h1 {
      color: #2a7d2e;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type="checkbox"] {
      margin-right: 10px;
    }
    select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .metrics {
      margin-top: 25px;
    }
    .metric {
      background: #f1f1f1;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      font-size: 16px;
    }
    .red {
      color: darkred;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Olive OS – Live Dashboard</h1><label>
  <input type="checkbox" id="customerWise"> Customer Wise
</label>
<label>
  <input type="checkbox" id="regionWise"> Region Wise
</label>

<label for="selectionDropdown">Select Name</label>
<select id="selectionDropdown"></select>

<div class="metrics">
  <div class="metric" id="totalSales">Total Sales Value: ₹0</div>
  <div class="metric" id="totalOutstanding">Total Outstanding: ₹0</div>
  <div class="metric red" id="os90">90+ Days Outstanding: ₹0</div>
  <div class="metric" id="os60to90">60–90 Days Outstanding: ₹0</div>
  <div class="metric" id="dso">DSO: 0 days</div>
</div>

  </div>  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-vRAdDwX9qitwUOes0kHJDH7s1Xi35zEnjtNxvaAP2nz4vtYW3w35GFkaYN9uWg/pub?output=csv";

    const customerWiseCheckbox = document.getElementById("customerWise");
    const regionWiseCheckbox = document.getElementById("regionWise");
    const dropdown = document.getElementById("selectionDropdown");

    let data = [];

    function fetchCSV() {
      fetch(SHEET_URL)
        .then(res => res.text())
        .then(csv => {
          const lines = csv.split("\n").slice(1);
          data = lines.map(row => {
            const cols = row.split(",");
            return {
              name: cols[1]?.trim(),
              region: cols[2]?.trim(),
              invoiceValue: parseFloat(cols[6]) || 0,
              pendingAmount: parseFloat(cols[7]) || 0,
              days: parseInt(cols[5]) || 0
            }
          });
          updateDropdown();
        });
    }

    function updateDropdown() {
      dropdown.innerHTML = "";
      const selectedType = customerWiseCheckbox.checked ? "name" : regionWiseCheckbox.checked ? "region" : null;
      if (!selectedType) return;
      const values = [...new Set(data.map(item => item[selectedType]).filter(x => x))];
      values.forEach(val => {
        const option = document.createElement("option");
        option.value = val;
        option.textContent = val;
        dropdown.appendChild(option);
      });
    }

    function calculateMetrics() {
      const selectedType = customerWiseCheckbox.checked ? "name" : regionWiseCheckbox.checked ? "region" : null;
      const selectedValue = dropdown.value;
      const filtered = data.filter(item => item[selectedType] === selectedValue);

      const totalSales = filtered.reduce((sum, r) => sum + r.invoiceValue, 0);
      const totalOS = filtered.reduce((sum, r) => sum + r.pendingAmount, 0);
      const os90 = filtered.filter(r => r.days > 90).reduce((sum, r) => sum + r.pendingAmount, 0);
      const os60to90 = filtered.filter(r => r.days > 60 && r.days <= 90).reduce((sum, r) => sum + r.pendingAmount, 0);
      const dso = totalSales > 0 ? Math.round((totalOS / totalSales) * 365) : 0;

      document.getElementById("totalSales").textContent = `Total Sales Value: ₹${totalSales.toLocaleString()}`;
      document.getElementById("totalOutstanding").textContent = `Total Outstanding: ₹${totalOS.toLocaleString()}`;
      document.getElementById("os90").textContent = `90+ Days Outstanding: ₹${os90.toLocaleString()}`;
      document.getElementById("os60to90").textContent = `60–90 Days Outstanding: ₹${os60to90.toLocaleString()}`;
      document.getElementById("dso").textContent = `DSO: ${dso} days`;
    }

    customerWiseCheckbox.addEventListener("change", () => {
      regionWiseCheckbox.checked = false;
      updateDropdown();
    });
    regionWiseCheckbox.addEventListener("change", () => {
      customerWiseCheckbox.checked = false;
      updateDropdown();
    });
    dropdown.addEventListener("change", calculateMetrics);

    fetchCSV();
  </script></body>
</html>
